<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <title>Modulit AB - Can you trust CultureInfo?</title>
	<!-- core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/font-awesome.min.css" rel="stylesheet">
    <link href="/css/animate.min.css" rel="stylesheet">
    <link href="/css/owl.carousel.css" rel="stylesheet">
    <link href="/css/owl.transitions.css" rel="stylesheet">
    <link href="/css/prettyPhoto.css" rel="stylesheet">
    <link href="/css/main.css" rel="stylesheet">
    <link href="/css/responsive.css" rel="stylesheet">
    <link href="/css/agate.css" rel="stylesheet">
    <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
    <script src="js/respond.min.js"></script>
    <![endif]-->       
    <link rel="shortcut icon" href="/images/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="/images/ico/apple-touch-icon-57-precomposed.png">
</head>

<body id="home" class="homepage">

    <header id="header">
        <nav id="main-menu" class="navbar navbar-default navbar-fixed-top" role="banner">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Meny</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="index.html"><img src="/images/logo.png" alt="logo"></a>
                </div>

                <div class="collapse navbar-collapse navbar-right">
                    <ul class="nav navbar-nav">
                        <li><a href="/">Start</a></li>
                        <li class="active"><a href="/blog">Blog</a></li>
                    </ul>
                </div>
            </div><!--/.container-->
        </nav><!--/nav-->
    </header><!--/header-->

   

    <section id="features">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title text-center wow fadeInDown">Can you trust CultureInfo?</h2>
                <p class="text-center wow fadeInDown">Written by Oskar Sjöberg on 30:th of september 2016</p>
            </div>
            <div class="row wow fadeInLeft">
                <div class="col-sm-8 col-sm-offset-2">
                    <p>I’ve been porting a multilingual e-commerce web site from PHP/ CodeIgniter to ASP.Net / MVC, it has been live for almost six months now, on the whole; the port was a breeze.</p>
                    <p>Last week I decided to refactor some code left from the PHP-era; custom code for managing culture-specific formatting of numbers and currencies. It was a horrible mess of conditions and string formatting with regular expressions, it did not support alternate placements of the currency symbol and it was difficult to extend with new currencies.</p>
                    <p>Also I thought the refactoring would be quite easy. Just set the correct Thread.CurrentThread.CurrentCulture and Thread.CurrentThread.CurrentUICulture based on the visited domain on Application_BeginRequst and then replace all calls to the ported formatting functions to the ones built into the BCL.</p>
                    <p>It all seemed straight forward until I visited the Swedish version of the page where I directly saw an error.</p>
                    <p>Short translated summary from the <a href="https://sv.wikipedia.org/wiki/Wikipedia:Skrivregler ">Swedish writing rules</a> on Wikipedia (Be aware; Swedish link).</p>
                    <p>Numbers are written with a space grouping separator between every group of three digits from the right, like this: 1 000 with optional decimals. Swedish currency is written the same way but optionally with two decimals and a trailing currency symbol, “kr”, like this: 1 000,00 kr.</p>
                    <p>So my thinking was that in code, it would look like this:</p>

                    <br/><pre><code class="cs">Thread.CurrentThread.CurrentCulture = new CultureInfo("sv-SE", useUserOverride: false);
.
.
.
Console.WriteLine(1000.ToString("N"));
Console.WriteLine(1000.ToString("C"));</code></pre><br/>
                    <p>The output for currency however, did not match my expectations:</p>
                    <blockquote>
                            <p>1 000,00</p>
                            <p>1.000,00 kr</p>
                        </blockquote>
                        <p>I obviously spotted this because Swedish is my native language. What I find interesting is that it is only currencies that use the “.” grouping separator.</p>
                        <p>After some poking around I found out that CultureInfo.NumberFormatInfo contains two properties for what the grouping symbol would be; <a href="https://msdn.microsoft.com/en-us/library/system.globalization.numberformatinfo.numbergroupseparator(v=vs.110).aspx">NumberGroupSeparator</a> and <a href="https://msdn.microsoft.com/en-us/library/system.globalization.numberformatinfo.currencygroupseparator(v=vs.110).aspx">CurrencyGroupSeparator</a>.</p>
                        <p>So I decided to investigate how common it is for cultures to have a different grouping separator for numbers than the grouping separator for currencies.</p>
                        <br/>
                        <pre><code class="cs">CultureInfo
    .GetCultures(CultureTypes.AllCultures)
    .Where(cultureInfo => cultureInfo.NumberFormat.CurrencyGroupSeparator != cultureInfo.NumberFormat.NumberGroupSeparator)
    .Select(cultureInfo => new { cultureInfo.EnglishName, cultureInfo.Name, cultureInfo.NumberFormat.CurrencyGroupSeparator, cultureInfo.NumberFormat.NumberGroupSeparator })</code></pre>
                        <br/>
                        <table class="table span-6">
                            <tr>
                                <th>EnglishName </th>
                                <th>Name </th>
                                <th>CurrencyGroupSeparator</th>
                                <th>NumberGroupSeparator</th>
                            </tr>
                            <tr>
                                <td>Dutch (Belgium)</td>
                                <td>nl-BE</td>
                                <td>.</td>
                                <td> </td>
                            </tr>
                            <tr>
                                <td>Dari</td>
                                <td>prs</td>
                                <td>,</td>
                                <td>.</td>
                            </tr>
                            <tr>
                                <td>Dari (Afghanistan)</td>
                                <td>prs-AF</td>
                                <td>,</td>
                                <td>.</td>
                            </tr>
                            <tr>
                                <td>Sami, Northern (Sweden)</td>
                                <td>se-SE</td>
                                <td>.</td>
                                <td> </td>
                            </tr>
                            <tr>
                                <td>Sami (Southern)</td>
                                <td>sma</td>
                                <td>.</td>
                                <td> </td>
                            </tr>
                            <tr>
                                <td>Sami, Southern (Sweden)</td>
                                <td>sma-SE</td>
                                <td>.</td>
                                <td> </td>
                            </tr>
                            <tr>
                                <td>Sami (Lule)</td>
                                <td>smj</td>
                                <td>.</td>
                                <td> </td>
                            </tr>
                            <tr>
                                <td>Sami, Lule (Sweden)</td>
                                <td>smj-SE</td>
                                <td>.</td>
                                <td> </td>
                            </tr>
                            <tr>
                                <td>Swedish</td>
                                <td>sv</td>
                                <td>.</td>
                                <td> </td>
                            </tr>
                            <tr>
                                <td>Swedish (Sweden)</td>
                                <td>sv-SE</td>
                                <td>.</td>
                                <td> </td>
                            </tr>
                        </table>

                    <p>Out of 832 cultures on my machine there are only ten that have different group separators. I can obviously tell that this is not right for Swedish, and likely it is not right for Sami which is a language used by the Sami people in the northern part of Sweden, Finland and Norway.</p>
                    <p>However when visiting various e-commerce sites like the <a href="https://www.microsoftstore.com/store/mseea/sv_SE/home">Swedish version of the Microsoft store</a>, they print out the currency correct. Also applying the currency format on a cell in Excel is also correct and has probably been correct through all times.</p>
                    <p>The culture data used by CultureInfo is fetched from the operating system. It seems like Microsoft itself is not using the data provided from the operating system.                        
                    <p>Also note that different versions of Windows come with different settings pre-loaded. For example the currency symbol for da-DK (Danish-Denmark) is printed before the value on Windows Server 2012 but on Windows 10 the currency symbol is printed after the value. This means that your development environment will not yield the same result as the production server.</p>
                    <p>The solution in my case was pretty straight forward, clone the Swedsh CultureInfo including its NumberFormat and change the CurrencyGroupSeparator to space, and then set the Thread.CurrentCulture to my customized version.</p>

                    <p>But this makes me beg the question, if everyone using CultureInfo need to make work-arounds for the errors in CultureInfo and handle descrepancies between operating systems, what is the point of CultureInfo? Are there any more errors and descrepancies in the CultureInfo data that I need to compensate for? Next time I am not likely to be familiar with the language and can spot the error.</p>
                </div>
            </div>
        </div>
    </section>
    
    <section>
      <div class="container">
        <div class="row">
          <div class="col-sm-8 col-lg-offset-2">
          
          <div id="disqus_thread"></div>
<script>

var disqus_config = function () {
    this.page.url = "modulit.se";
    this.page.identifier = '2';
};

(function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = '//modulit.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
})();
</script>
          
          </div>
        </div>
      </div>
    </section>

    <footer id="footer">
        <div class="container">
            <div class="row">
                <div class="col-sm-6">
                    &copy; 2016 Modulit AB
                </div>
            </div>
        </div>
    </footer><!--/#footer-->

    <script src="/js/jquery.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="http://maps.google.com/maps/api/js?key=AIzaSyDTxiNW3r80LkGfqLS70U1Lk9Ip225i6QQ"></script>
    <script src="/js/owl.carousel.min.js"></script>
    <script src="/js/jquery.prettyPhoto.js"></script>
    <script src="/js/jquery.isotope.min.js"></script>
    <script src="/js/jquery.inview.min.js"></script>
    <script src="/js/wow.min.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-83920640-1', 'auto');
      ga('send', 'pageview');
    </script>
</body>
</html>